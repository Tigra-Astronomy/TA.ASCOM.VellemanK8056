<?xml version="1.0" encoding="UTF-8"?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <?include $(sys.CURRENTDIR)\Config.wxi?>
  
  <!--
  Defines the ASCOM custom actions and schedules them for execution at the appropriate times.
  You must reference each of these custom actions with a <CustomActionRef/> from within your <Product/> element.
  Do not change anything in this file, or things will break.
  -->

  <Fragment>
    <Binary Id="AscomCustomActions"
            SourceFile="..\packages\TA.Ascom.WixCustomActions.0.1.0-Beta15\lib\net40\TA.Ascom.WixCustomActions.CA.dll" />
    <CustomAction Id="caPrepareAscomDeviceProfiles"
                  BinaryKey="AscomCustomActions" 
                  DllEntry="EnumerateAscomDeviceProfiles"
                  Execute="immediate"
                  Return="check" />
    <CustomAction Id="caRegisterDrivers"
                  BinaryKey="AscomCustomActions"
                  DllEntry="RegisterAscomDeviceProfiles"
                  Execute="deferred" 
                  Return="check" />
    <CustomAction Id="caUnregisterDrivers" 
                  BinaryKey="AscomCustomActions" 
                  DllEntry="UnregisterAscomDeviceProfiles"
                  Execute="deferred"
                  Return="ignore" />
    <InstallExecuteSequence>
      <Custom Action="caPrepareAscomDeviceProfiles" Before="InstallInitialize" />
      <Custom Action="caUnregisterDrivers" After="RemoveFiles">Installed OR MaintenanceMode="Modify" OR UPGRADINGPRODUCTCODE</Custom>
      <Custom Action="caRegisterDrivers" Before="InstallFiles">NOT REMOVE OR Installed</Custom>
    </InstallExecuteSequence>
  </Fragment>
</Wix>